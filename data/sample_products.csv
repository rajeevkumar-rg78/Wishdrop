import csv
from pathlib import Path

# -----------------------------------------
# Luxury-only product generator for WishDrop
# -----------------------------------------
OUT_PATH = Path("data/sample_products.csv")


BRANDS = [
    {
        "brand": "Prada",
        "stores": ["Saks Fifth Avenue", "Neiman Marcus", "Bergdorf Goodman", "Prada Boutique"],
        "categories": ["Women > Bags", "Women > Shoes", "Women > Dresses", "Women > Jackets"]
    },
    {
        "brand": "Gucci",
        "stores": ["Saks Fifth Avenue", "Neiman Marcus", "Nordstrom", "Gucci Boutique"],
        "categories": ["Women > Bags", "Women > Shoes", "Women > Dresses", "Accessories > Belts"]
    },
    {
        "brand": "Louis Vuitton",
        "stores": ["Louis Vuitton", "Saks Fifth Avenue", "Neiman Marcus"],
        "categories": ["Women > Bags", "Accessories > Wallets", "Women > Shoes"]
    },
    {
        "brand": "Chanel",
        "stores": ["Chanel Boutique", "Nordstrom"],
        "categories": ["Women > Bags", "Women > Shoes", "Beauty > Fragrance", "Beauty > Makeup"]
    },
    {
        "brand": "Dior",
        "stores": ["Dior Boutique", "Sephora", "Saks Fifth Avenue"],
        "categories": ["Beauty > Fragrance", "Beauty > Makeup", "Women > Dresses"]
    },
    {
        "brand": "Burberry",
        "stores": ["Nordstrom", "Saks Fifth Avenue", "Burberry Boutique"],
        "categories": ["Women > Jackets", "Men > Jackets", "Women > Bags"]
    },
    {
        "brand": "Saint Laurent",
        "stores": ["Saks Fifth Avenue", "Neiman Marcus", "Bergdorf Goodman"],
        "categories": ["Women > Bags", "Women > Shoes", "Women > Dresses"]
    },
    {
        "brand": "Fendi",
        "stores": ["Saks Fifth Avenue", "Neiman Marcus"],
        "categories": ["Women > Bags", "Accessories > Wallets", "Women > Shoes"]
    },
    {
        "brand": "Valentino",
        "stores": ["Saks Fifth Avenue", "Neiman Marcus", "Nordstrom"],
        "categories": ["Women > Shoes", "Women > Dresses", "Women > Bags"]
    },
    {
        "brand": "Givenchy",
        "stores": ["Saks Fifth Avenue", "Sephora"],
        "categories": ["Beauty > Fragrance", "Women > Bags", "Women > Shoes"]
    },
    {
        "brand": "Bottega Veneta",
        "stores": ["Saks Fifth Avenue", "Neiman Marcus"],
        "categories": ["Women > Bags", "Women > Shoes"]
    },
    {
        "brand": "Celine",
        "stores": ["Saks Fifth Avenue", "Neiman Marcus"],
        "categories": ["Women > Bags", "Women > Dresses"]
    }
]

# Simple style words so names look more human
STYLES = [
    "Classic", "Signature", "Runway", "Icon", "Limited",
    "Mini", "Large", "Quilted", "Leather", "Canvas"
]

# -----------------------------------------
# Helper functions
# -----------------------------------------
def base_price_for(category: str) -> float:
    """Return a realistic MSRP given the category."""
    if "Bags" in category or "Wallets" in category:
        return 2200.0
    if "Shoes" in category:
        return 950.0
    if "Dresses" in category or "Jackets" in category:
        return 1800.0
    if "Fragrance" in category:
        return 165.0
    if "Makeup" in category:
        return 75.0
    if "Belts" in category:
        return 650.0
    return 1200.0


def price_with_discount(msrp: float, discount_pct: int) -> float:
    return round(msrp * (1 - discount_pct / 100.0), 2)


def image_url_for(brand: str, category: str) -> str:
    """
    Use Unsplash source images with a consistent query.
    This stays abstract but looks visually right.
    """
    query_parts = [brand]
    if "Bags" in category or "Wallets" in category:
        query_parts.append("luxury bag")
    elif "Shoes" in category:
        query_parts.append("designer shoes")
    elif "Dresses" in category:
        query_parts.append("designer dress")
    elif "Jackets" in category:
        query_parts.append("trench coat")
    elif "Fragrance" in category:
        query_parts.append("perfume bottle")
    elif "Makeup" in category:
        query_parts.append("makeup flatlay")
    elif "Belts" in category:
        query_parts.append("designer belt")
    else:
        query_parts.append("fashion")

    query = "+".join(q.replace(" ", "+") for q in query_parts)
    return f"https://source.unsplash.com/600x750/?{query}"


def product_url_for(store: str, name: str) -> str:
    """Fake but plausible product search URL."""
    base = {
        "Saks Fifth Avenue": "https://www.saksfifthavenue.com/search?keyword=",
        "Neiman Marcus": "https://www.neimanmarcus.com/search.jsp?Ntt=",
        "Bergdorf Goodman": "https://www.bergdorfgoodman.com/search.jsp?Ntt=",
        "Nordstrom": "https://www.nordstrom.com/sr?keyword=",
        "Bloomingdale's": "https://www.bloomingdales.com/shop/featured/",
        "Prada Boutique": "https://www.prada.com/search?q=",
        "Gucci Boutique": "https://www.gucci.com/us/en/search/?q=",
        "Louis Vuitton": "https://us.louisvuitton.com/eng-us/search/",
        "Chanel Boutique": "https://www.chanel.com/us/search/?q=",
        "Dior Boutique": "https://www.dior.com/en_us/search?q=",
        "Burberry Boutique": "https://us.burberry.com/search/?q=",
        "Sephora": "https://www.sephora.com/search?keyword="
    }.get(store, "https://www.google.com/search?q=")

    q = name.replace(" ", "+")
    return f"{base}{q}"


# -----------------------------------------
# Build 100 luxury products
# -----------------------------------------
def build_products(max_items: int = 100):
    rows = []
    next_id = 1000

    for brand_info in BRANDS:
        brand = brand_info["brand"]
        for store in brand_info["stores"]:
            for category in brand_info["categories"]:
                if len(rows) >= max_items:
                    break

                # Create 1–2 variations per combo
                for style in STYLES[:2]:
                    if len(rows) >= max_items:
                        break

                    next_id += 1
                    pid = f"L-{next_id}"

                    # Build a nice name
                    base_name = category.split(">")[-1].strip()  # e.g. "Bags"
                    if "Bags" in base_name:
                        item_word = "Bag"
                    elif "Shoes" in base_name:
                        item_word = "Heels"
                    elif "Dresses" in base_name:
                        item_word = "Dress"
                    elif "Jackets" in base_name:
                        item_word = "Jacket"
                    elif "Wallets" in base_name:
                        item_word = "Wallet"
                    elif "Belts" in base_name:
                        item_word = "Belt"
                    elif "Fragrance" in base_name:
                        item_word = "Eau de Parfum"
                    elif "Makeup" in base_name:
                        item_word = "Lipstick"
                    else:
                        item_word = base_name

                    name = f"{brand} {style} {item_word}"

                    msrp = base_price_for(category)

                    # choose a realistic discount 15–45%
                    discount_pct = 15 + ((next_id * 7) % 31)  # deterministic but varied
                    price = price_with_discount(msrp, discount_pct)

                    img = image_url_for(brand, category)
                    url = product_url_for(store, name)

                    rows.append({
                        "id": pid,
                        "name": name,
                        "brand": brand,
                        "category": category,
                        "store": store,
                        "msrp": round(msrp, 2),
                        "price": price,
                        "discount_pct": discount_pct,
                        "image_url": img,
                        "product_url": url,
                    })

                if len(rows) >= max_items:
                    break
            if len(rows) >= max_items:
                break
        if len(rows) >= max_items:
            break

    return rows


def main():
    rows = build_products(max_items=100)

    OUT_PATH.parent.mkdir(parents=True, exist_ok=True)
    with OUT_PATH.open("w", newline="", encoding="utf-8") as f:
        writer = csv.DictWriter(
            f,
            fieldnames=[
                "id",
                "name",
                "brand",
                "category",
                "store",
                "msrp",
                "price",
                "discount_pct",
                "image_url",
                "product_url",
            ],
        )
        writer.writeheader()
        writer.writerows(rows)

    print(f"Wrote {len(rows)} luxury items to {OUT_PATH}")


if __name__ == "__main__":
    main()
